$(function(){$.fn.hasAttr=function(e){return this.attr(e)!==undefined};Alive={init:function(){this.theAnswerToLifeTheUniverseAndEverything=42;this.radius=200;this.radial=$("#radial_container");this.scene=$(".scene");this.gun=$(".gun");this.shoot=$(".shoot");this.roll=$(".roll");this.holeInput=$(".hole-input"),this.startButton=$(".start.btn");this.msgArea=$(".message-area");this.turnCount=0;this.shortArray=[];this.animSpeed=10;this.makeRadialMenu();this.events();Alive.onInit()},makeRadialMenu:function(){this.radial.radmenu({listClass:"gun",itemClass:"bullet",radius:Alive.radius,animSpeed:Alive.animSpeed,centerX:Alive.radius,centerY:Alive.radius,selectEvent:"click",angleOffset:0}).radmenu("show");this.bullet=$(".radial_div_item")},events:function(){Alive.onRoll();Alive.onBulletClick();Alive.onHoleInput()},onRoll:function(){Alive.roll.on("click",function(){var e=0,t=1.1;while(e<Alive.theAnswerToLifeTheUniverseAndEverything){Alive.radial.radmenu("next");Alive.radial.radmenu("opts").animSpeed*=t;e++}Alive.radial.radmenu("opts").animSpeed=10;Alive.msg("You survived. Try with a different order!");Alive.holeInput.focus()})},msg:function(e,t){Alive.msgArea.html(e).css({opacity:0}).animate({opacity:1},250);t!=0&&Alive.msgArea.delay(t||6e3).animate({opacity:0},250,"",function(){})},onInit:function(){Alive.msg("Set number of holes and insert some bullets to see the probabilities.",0)},checkStartButton:function(){if(!Alive.startButton.hasAttr("disabled")){if(Alive.startButton.is(":visible")){Alive.startButton.off("click");Alive.startButton.on("click",Alive.startTheGame)}}else Alive.pauseTheGame()},startTheGame:function(){Alive.msg("I'll shoot for once.<br>Then it is your turn.",0);Alive.startButton.fadeOut(200);setTimeout(function(){Alive.countBullets();Alive.msg("I managed to survive.<br>Your turn.<br>Shoot or roll?",0);Alive.radial.radmenu("opts").animSpeed=500;Alive.radial.radmenu("next");Alive.turnCount++;Alive.radial.radmenu("opts").animSpeed=10;Alive.shoot.fadeIn(200);Alive.roll.fadeIn(200)},2e3)},pauseTheGame:function(){Alive.startButton.fadeIn(200);Alive.shoot.fadeOut(200);Alive.roll.fadeOut(200)},onBulletClick:function(){Alive.bullet.on("click",function(){$(this).toggleClass("full");Alive.countBullets()})},onHoleInput:function(){Alive.holeInput.on("keyup",function(){Alive.startButton.fadeIn(200);var e=$(this).val();Alive.gun.html("");for(var t=0;t<e;t++)Alive.gun.append('<li class="bullet" style="display:none"></li>');Alive.makeRadialMenu();Alive.onBulletClick();Alive.onInit();Alive.countBullets()})},countBullets:function(){Alive.shortArray=[];$.each(Alive.bullet,function(){Alive.shortArray.push($(this).hasClass("full")?1:0)});Alive.makeCalculations(Alive.shortArray)},makeCalculations:function(e){var t=0,n=0,r,i,s,o,u=e.length,a="Probability of survival: <br>",f;for(f=0;f<u;f++)e[f]==0?t++:n++;n>0?Alive.startButton.removeAttr("disabled"):Alive.startButton.attr("disabled","disabled");if(t==0){Alive.startButton.attr("disabled","disabled");Alive.msg("At least one empty hole",0)}else Alive.onInit();Alive.checkStartButton();r=Alive.probabilityOnRoll(t,n)*100;i=Alive.probabilityOnShoot(e,t,n)*100;s="Spin & Shot: %"+r.toString().substr(0,8);o="Immediate shot: %"+i.toString().substr(0,8);r>i?a+="<strong>"+s+"</strong><br>"+o:r<i?a+=s+"<br><strong>"+o+"</strong>":a+=s+"<br>"+o;Alive.msg(a,0)},probabilityOnRoll:function(e,t){return e/(e+t)},probabilityOnShoot:function(arr,empty,full){var t=Alive.turnCount+1,i=0,j=0,l=arr.length,condition="",s=0,cndt;for(j=0;j<=t;j++)condition+="(arr[(i+"+j+")%l]) == 0 && ";condition+="1";$.each(arr,function(){cndt=eval("{"+condition+"}");cndt&&s++;i++});return s/empty}};Alive.init()});